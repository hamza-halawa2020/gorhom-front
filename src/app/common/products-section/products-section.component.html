<!-- Success Message as a Toast -->
<div *ngIf="successMessage" class="toast-container position-fixed top-0"
    [class.start-0]="translate.currentLang === 'ar'" [class.end-0]="translate.currentLang !== 'ar'" p-3>
    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong [class.ms-auto]="translate.currentLang === 'ar'" [class.me-auto]="translate.currentLang !== 'ar'"
                class="text-success">
                {{ "SUCCESS" | translate }}
            </strong>
        </div>
        <div class="toast-body">
            <h6>{{ successMessage }}</h6>
        </div>
    </div>
</div>

<!-- Error Message as a Toast -->
<div *ngIf="errorMessage" class="toast-container position-fixed top-0" [class.start-0]="translate.currentLang === 'ar'"
    [class.end-0]="translate.currentLang !== 'ar'" p-3>
    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong [class.ms-auto]="translate.currentLang === 'ar'" [class.me-auto]="translate.currentLang !== 'ar'"
                class="text-danger">
                {{ "ERROR" | translate }}
            </strong>
        </div>
        <div class="toast-body">
            <h6>{{ errorMessage }}</h6>
        </div>
    </div>
</div>

<!-- Explore & Shop Link -->
<div class="text-center mt-5 mb-4 fw-semibold">
    <a routerLink="/products" class="explore-link">
        {{ "EXPLORE_AND_SHOP" | translate }}
    </a>
</div>

<div class="products-section" [dir]="translate.currentLang === 'ar' ? 'rtl' : 'ltr'">
    <div class="container">
        <!-- Section Filters -->
        <div class="filters mb-4 d-flex justify-content-center">
            <button class="filter-btn" [ngClass]="{ active: activeFilter === 'all' }" (click)="setFilter('all')">
                <i class="fas fa-tags"></i> {{ "ALL" | translate }}
            </button>
            <button class="filter-btn" [ngClass]="{ active: activeFilter === 'offers' }" (click)="setFilter('offers')">
                <i class="fas fa-rocket"></i> {{ "OUR_OFFERS" | translate }}
            </button>
            <button class="filter-btn" [ngClass]="{ active: activeFilter === 'BEST_PRICE' }"
                (click)="setFilter('BEST_PRICE')">
                <i class="fas fa-award"></i> {{ "BEST_PRICE" | translate }}
            </button>
        </div>

        <!-- Products Grid -->
        <div class="row g-4">
            <div class="col-xl-3 col-lg-4 col-md-6 col-6" *ngFor="let product of filteredProducts; let i = index">
                <div class="product-card">
                    <!-- Discount Badge -->
                    <div class="discount-badge" *ngIf="product.discount > 0">
                        -{{ product.discount }} {{ "EGP" | translate }}
                    </div>

                    <!-- Favorite Button -->
                    <button *ngIf="isLoggedIn" class="favorite-btn" (click)="addToFavourite(product.id)"
                        [attr.title]="isProductInFavorites(product.id) ? ('REMOVE_FROM_WISHLIST' | translate) : ('ADD_TO_WISHLIST' | translate)">
                        <i class="fa" [class.fa-heart]="isProductInFavorites(product.id)"
                            [class.fa-heart-o]="!isProductInFavorites(product.id)"
                            [style.color]="isProductInFavorites(product.id) ? '#e74c3c' : ''"></i>
                    </button>
                    <button class="favorite-btn" *ngIf="!isLoggedIn" (click)="addToClientFavourite(product)"
                        [attr.title]="isProductInFavorites(product.id) ? ('REMOVE_FROM_WISHLIST' | translate) : ('ADD_TO_WISHLIST' | translate)">
                        <i class="fa" [class.fa-heart]="isProductInFavorites(product.id)"
                            [class.fa-heart-o]="!isProductInFavorites(product.id)"
                            [style.color]="isProductInFavorites(product.id) ? '#e74c3c' : ''"></i>
                    </button>
                    <!-- Product Image -->
                    <div class="product-image">
                        <!-- Default Image -->
                        <a routerLink="/product/{{ product.id }}">
                            <img class="default-image img-fluid"
                                [ngSrc]="product.image ? image + product.image : 'assets/images/logo_optimized.svg'"
                                [alt]="product.title" width="320" height="480" [priority]="i < 4"
                                sizes="(max-width: 576px) 50vw, (max-width: 992px) 33vw, 25vw" />

                        </a>

                        <!-- Hover Overlay -->
                        <div class="overlay">
                            <div class="overlay-content">
                                <div class="quantity-selector d-flex align-items-center">
                                    <button class="btn add-to-cart-btn" (click)="addToCart(product.id)">
                                        <i class="fas"
                                            [ngClass]="isProductInCart(product.id) ? 'fa-check' : 'fa-shopping-cart'"></i>
                                        <span class="add-to-cart-text">{{
                                            (isProductInCart(product.id) ? "ALREADY_IN_CART" : "ADD_TO_CART") |
                                            translate
                                            }}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a routerLink="/product/{{ product.id }}">
                        <!-- Product Info -->
                        <div class="product-info text-center mt-3">
                            <h3 class="product-title">{{ product.title }}</h3>
                            <div class="price">
                                <span class="discounted-price">{{ getDefaultSizePrice(product) }} EGP</span>
                                <span class="original-price" *ngIf="
                                        getDefaultSizePriceBeforeDiscount(product) &&
                                        getDefaultSizePriceBeforeDiscount(product) !==
                                        getDefaultSizePrice(product)
                                    ">

                                    {{ getDefaultSizePriceBeforeDiscount(product) }} EGP
                                </span>
                            </div>
                            <div class="discount-info mt-1"
                                *ngIf="getDefaultSize(product) && getDefaultSizePriceBeforeDiscount(product) && (getDefaultSizePriceBeforeDiscount(product) ?? 0) !== getDefaultSizePrice(product)">
                                <small class="text-danger">{{ "DISCOUNT" | translate }}: {{
                                    (getDefaultSizePriceBeforeDiscount(product) ?? 0) - getDefaultSizePrice(product) }}
                                    EGP</small>
                            </div>
                            <div class="size-info mt-1" *ngIf="getDefaultSize(product)">
                                <small class="text-muted">{{ "SIZE" | translate }}: {{ getDefaultSize(product).size
                                    }}</small>
                            </div>
                            <div class="category mt-1">
                                <small>{{ product.category.name }}</small>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-5">
            <a routerLink="/products" class="load-more-btn">{{
                "LOAD_MORE" | translate
                }}</a>
        </div>
    </div>
</div>